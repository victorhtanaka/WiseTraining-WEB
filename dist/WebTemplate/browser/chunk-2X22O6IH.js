import{a as Se,c as we,g as Ie,j as Fe}from"./chunk-3T3Z5BFP.js";import"./chunk-F5X5MWHG.js";import{b as ye,c as Ee}from"./chunk-IBRRAY2N.js";import{c as Ke,f as Ye,g as Ze,i as et}from"./chunk-5R5HMRID.js";import{a as ve,b as Me,c as be}from"./chunk-P7CFY6IH.js";import{D as L,E as R,F as We,G as B,H as j,I as V,J as Je,K as Qe,L as Xe,b as De,c as Te,d as Ge,e as ke,f as Ne,g as Pe,h as Ue,i as Oe,j as Ae,k as $e,l as Le,o as Re,r as Be,s as je,t as Ve,u as ze,w as He,z as qe}from"./chunk-5VTVZEZ6.js";import{$a as W,Ad as le,Bd as de,Ca as o,Cb as te,Cc as oe,Cd as ce,Da as r,Dd as pe,Ea as _,Ed as ue,Fa as y,Fd as ge,Ga as E,Gb as ie,Gd as fe,Hc as w,Ia as I,Ic as re,Id as _e,J as Q,Jb as ne,Ka as f,Kd as F,La as p,Ld as A,Md as he,Q as C,R as v,Rd as D,Sd as xe,Ta as a,Ua as h,Va as Y,Vd as $,Wa as Z,Wd as Ce,Xa as z,Ya as H,Za as q,ed as ae,fa as m,gd as K,hd as me,ja as u,jd as T,ld as g,ma as b,na as X,nb as J,ob as S,od as G,pd as k,ra as c,rd as N,sb as ee,ta as d,td as P,wd as U,yd as O,zd as se}from"./chunk-346T4PMV.js";function nt(t,l){if(t&1&&(o(0,"mat-option",8),a(1),r()),t&2){let e=l.$implicit;d("value",e.id),m(),Z(" ",e.fullName," (",e.email,") ")}}function ot(t,l){if(t&1){let e=I();o(0,"div")(1,"p"),a(2,"Selecione um usu\xE1rio para adicionar ao grupo:"),r(),o(3,"mat-form-field",5)(4,"mat-label"),a(5,"Selecionar Usu\xE1rio"),r(),o(6,"mat-select",6),q("valueChange",function(i){C(e);let s=p();return H(s.selectedUserId,i)||(s.selectedUserId=i),v(i)}),c(7,nt,2,3,"mat-option",7),r()()()}if(t&2){let e=p();m(6),z("value",e.selectedUserId),m(),d("ngForOf",e.availableUsers)}}function rt(t,l){t&1&&(o(0,"div")(1,"p"),a(2,"N\xE3o h\xE1 usu\xE1rios dispon\xEDveis para adicionar a este grupo."),r()())}function at(t,l){t&1&&(o(0,"mat-error"),a(1," Nome do grupo \xE9 obrigat\xF3rio "),r())}function mt(t,l){t&1&&(o(0,"mat-error"),a(1," Nome do grupo deve ter no m\xE1ximo 100 caracteres "),r())}function st(t,l){t&1&&(o(0,"mat-error"),a(1," Descri\xE7\xE3o deve ter no m\xE1ximo 200 caracteres "),r())}function lt(t,l){if(t&1&&(o(0,"p"),a(1,"Tem certeza que deseja excluir o grupo "),o(2,"strong"),a(3),r(),a(4,"?"),r()),t&2){let e=p();m(3),h(e.data.group.name)}}function dt(t,l){if(t&1&&(o(0,"p"),a(1),r()),t&2){let e=p();m(),h(e.data.message)}}function ct(t,l){t&1&&(o(0,"div",6)(1,"mat-icon",7),a(2,"warning"),r(),o(3,"span"),a(4,"N\xE3o \xE9 poss\xEDvel excluir o grupo Admin pois ele \xE9 essencial para o funcionamento da aplica\xE7\xE3o."),r()())}var tt=()=>["id","fullName","email","groups"];function pt(t,l){t&1&&(o(0,"mat-error"),a(1," Nome da empresa \xE9 obrigat\xF3rio "),r())}function ut(t,l){t&1&&(o(0,"mat-error"),a(1," Nome da empresa deve ter no m\xE1ximo 100 caracteres "),r())}function gt(t,l){t&1&&(o(0,"mat-error"),a(1," Dom\xEDnio deve ter no m\xE1ximo 50 caracteres "),r())}function ft(t,l){if(t&1&&(o(0,"mat-card-subtitle"),a(1),r()),t&2){let e=p().$implicit;m(),h(e.description)}}function _t(t,l){if(t&1){let e=I();o(0,"mat-list-item")(1,"div",35)(2,"span"),a(3),r(),o(4,"button",36),f("click",function(){let i=C(e).$implicit,s=p().$implicit,x=p(2);return v(x.confirmRemoveUserFromGroup(i,s))}),o(5,"mat-icon"),a(6,"delete"),r()()()()}if(t&2){let e=l.$implicit,n=p().$implicit,i=p(2);m(3),h(e.fullName),m(),d("disabled",i.isAdminUserInAdminGroup(e.id,n.id))("matTooltipDisabled",!i.isAdminUserInAdminGroup(e.id,n.id))("matTooltip",i.isAdminUserInAdminGroup(e.id,n.id)?"N\xE3o \xE9 poss\xEDvel remover a si mesmo do grupo Admin":"Remover do grupo")}}function ht(t,l){t&1&&(o(0,"mat-list-item")(1,"i"),a(2,"Nenhum usu\xE1rio neste grupo"),r()())}function xt(t,l){if(t&1){let e=I();o(0,"mat-card",29)(1,"mat-card-header")(2,"mat-card-title"),a(3),r(),c(4,ft,2,1,"mat-card-subtitle",10),o(5,"div",30)(6,"button",31),f("click",function(){let i=C(e).$implicit,s=p(2);return v(s.openGroupDialog(i))}),o(7,"mat-icon"),a(8,"edit"),r()(),o(9,"button",32),f("click",function(){let i=C(e).$implicit,s=p(2);return v(s.confirmDeleteGroup(i))}),o(10,"mat-icon"),a(11,"delete"),r()()()(),o(12,"mat-card-content")(13,"h3"),a(14,"Usu\xE1rios no Grupo"),r(),o(15,"mat-list"),c(16,_t,7,4,"mat-list-item",33)(17,ht,3,0,"mat-list-item",10),r()(),o(18,"mat-card-actions")(19,"button",34),f("click",function(){let i=C(e).$implicit,s=p(2);return v(s.openAddUserDialog(i))}),o(20,"mat-icon"),a(21,"person_add"),r(),a(22," Adicionar Usu\xE1rio "),r()()()}if(t&2){let e=l.$implicit;m(3),h(e.name),m(),d("ngIf",e.description),m(2),d("disabled",e.name.toLowerCase()==="admin")("matTooltip",e.name.toLowerCase()==="admin"?"N\xE3o \xE9 permitido editar o grupo Admin":"Editar grupo"),m(3),d("disabled",e.name.toLowerCase()==="admin")("matTooltip",e.name.toLowerCase()==="admin"?"N\xE3o \xE9 permitido excluir o grupo Admin":"Excluir grupo"),m(7),d("ngForOf",e.users),m(),d("ngIf",!e.users||e.users.length===0)}}function Ct(t,l){t&1&&(o(0,"th",37),a(1,"ID"),r())}function vt(t,l){if(t&1&&(o(0,"td",38),a(1),r()),t&2){let e=l.$implicit;m(),h(e.id)}}function Mt(t,l){t&1&&(o(0,"th",37),a(1,"Nome"),r())}function bt(t,l){if(t&1&&(o(0,"td",38),a(1),r()),t&2){let e=l.$implicit;m(),h(e.fullName)}}function yt(t,l){t&1&&(o(0,"th",37),a(1,"Email"),r())}function Et(t,l){if(t&1&&(o(0,"td",38),a(1),r()),t&2){let e=l.$implicit;m(),h(e.email)}}function St(t,l){t&1&&(o(0,"th",37),a(1,"Grupos"),r())}function wt(t,l){t&1&&(o(0,"span"),a(1,", "),r())}function It(t,l){if(t&1&&(y(0),a(1),c(2,wt,2,0,"span",10),E()),t&2){let e=l.$implicit,n=l.last;m(),Y(" ",e.name,""),m(),d("ngIf",!n)}}function Ft(t,l){if(t&1&&(o(0,"span"),c(1,It,3,2,"ng-container",33),r()),t&2){let e=p().$implicit;m(),d("ngForOf",e.groups)}}function Dt(t,l){t&1&&(o(0,"span")(1,"i"),a(2,"Nenhum grupo"),r()())}function Tt(t,l){if(t&1&&(o(0,"td",38),c(1,Ft,2,1,"span",10)(2,Dt,3,0,"span",10),r()),t&2){let e=l.$implicit;m(),d("ngIf",e.groups&&e.groups.length>0),m(),d("ngIf",!e.groups||e.groups.length===0)}}function Gt(t,l){t&1&&_(0,"tr",39)}function kt(t,l){t&1&&_(0,"tr",40)}function Nt(t,l){if(t&1){let e=I();o(0,"div",2)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),a(4,"Gerenciamento da Empresa"),r(),o(5,"mat-card-subtitle"),a(6,"Gerencie informa\xE7\xF5es da empresa, usu\xE1rios e grupos"),r()(),o(7,"mat-card-content")(8,"mat-tab-group",3),q("selectedIndexChange",function(i){C(e);let s=p();return H(s.activeTab,i)||(s.activeTab=i),v(i)}),o(9,"mat-tab",4)(10,"div",5)(11,"form",6),f("ngSubmit",function(){C(e);let i=p();return v(i.saveCompany())}),o(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),a(15,"Nome da Empresa"),r(),_(16,"input",9),c(17,pt,2,0,"mat-error",10)(18,ut,2,0,"mat-error",10),r()(),o(19,"div",7)(20,"mat-form-field",8)(21,"mat-label"),a(22,"Dom\xEDnio"),r(),_(23,"input",11),o(24,"mat-hint"),a(25,"Utilizado para verifica\xE7\xE3o de email ao registrar usu\xE1rios"),r(),c(26,gt,2,0,"mat-error",10),r()(),o(27,"div",12)(28,"button",13),a(29," Salvar Altera\xE7\xF5es "),r()()()()(),o(30,"mat-tab",14)(31,"div",5)(32,"div",15)(33,"button",16),f("click",function(){C(e);let i=p();return v(i.openGroupDialog())}),o(34,"mat-icon"),a(35,"add"),r(),a(36," Novo Grupo "),r()(),o(37,"div",17),c(38,xt,23,8,"mat-card",18),r()()(),o(39,"mat-tab",19)(40,"div",5)(41,"table",20),y(42,21),c(43,Ct,2,0,"th",22)(44,vt,2,1,"td",23),E(),y(45,24),c(46,Mt,2,0,"th",22)(47,bt,2,1,"td",23),E(),y(48,25),c(49,yt,2,0,"th",22)(50,Et,2,1,"td",23),E(),y(51,26),c(52,St,2,0,"th",22)(53,Tt,3,2,"td",23),E(),c(54,Gt,1,0,"tr",27)(55,kt,1,0,"tr",28),r()()()()()()()}if(t&2){let e,n,i,s=p();m(8),z("selectedIndex",s.activeTab),m(3),d("formGroup",s.companyForm),m(6),d("ngIf",(e=s.companyForm.get("name"))==null?null:e.hasError("required")),m(),d("ngIf",(n=s.companyForm.get("name"))==null?null:n.hasError("maxlength")),m(8),d("ngIf",(i=s.companyForm.get("domain"))==null?null:i.hasError("maxlength")),m(2),d("disabled",s.companyForm.invalid),m(10),d("ngForOf",s.groups),m(3),d("dataSource",s.users),m(13),d("matHeaderRowDef",W(10,tt)),m(),d("matRowDefColumns",W(11,tt))}}function Pt(t,l){t&1&&(o(0,"div",41),_(1,"mat-spinner",42),o(2,"p"),a(3,"Carregando..."),r()())}function Ut(t,l){if(t&1&&(o(0,"mat-error"),a(1),r()),t&2){let e=p();m(),h(e.getUsernameError())}}function Ot(t,l){if(t&1&&(o(0,"mat-error"),a(1),r()),t&2){let e=p();m(),h(e.getPasswordError())}}var At=(()=>{class t{constructor(e,n){this.dialogRef=e,this.data=n,this.availableUsers=[],this.selectedUserId=null}ngOnInit(){this.filterAvailableUsers()}filterAvailableUsers(){let e=this.data.groupUsers.map(n=>n.id);this.availableUsers=this.data.existingUsers.filter(n=>!e.includes(n.id))}onCancel(){this.dialogRef.close()}onSubmit(){this.selectedUserId&&this.dialogRef.close({userId:this.selectedUserId})}static{this.\u0275fac=function(n){return new(n||t)(u(L),u(R))}}static{this.\u0275cmp=b({type:t,selectors:[["app-add-user-dialog"]],standalone:!1,decls:10,vars:3,consts:[["mat-dialog-title",""],[4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["appearance","outline",1,"full-width"],[3,"valueChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,i){n&1&&(o(0,"h2",0),a(1,"Adicionar Usu\xE1rio ao Grupo"),r(),o(2,"mat-dialog-content"),c(3,ot,8,2,"div",1)(4,rt,3,0,"div",1),r(),o(5,"mat-dialog-actions",2)(6,"button",3),f("click",function(){return i.onCancel()}),a(7,"Cancelar"),r(),o(8,"button",4),f("click",function(){return i.onSubmit()}),a(9," Adicionar "),r()()),n&2&&(m(3),d("ngIf",i.availableUsers.length>0),m(),d("ngIf",i.availableUsers.length===0),m(4),d("disabled",!i.selectedUserId))},dependencies:[J,S,D,F,w,B,V,j,Be,Re],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}"]})}}return t})(),$t=(()=>{class t{constructor(e,n,i){this.fb=e,this.dialogRef=n,this.data=i}ngOnInit(){this.dialogTitle=this.data.isEditMode?"Editar Grupo":"Novo Grupo",this.initForm()}initForm(){this.groupForm=this.fb.group({id:[this.data.group?.id||0],name:[this.data.group?.name||"",[g.required,g.maxLength(100)]],description:[this.data.group?.description||"",[g.maxLength(200)]],companyId:[this.data.companyId]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.groupForm.valid){let e=this.groupForm.value,n=e.name.toLowerCase();if(this.data.isEditMode&&this.data.group?.name.toLowerCase()==="admin"){alert("N\xE3o \xE9 permitido editar o grupo Admin.");return}if(!this.data.isEditMode&&n==="admin"){alert('O nome "Admin" \xE9 reservado para o grupo padr\xE3o do sistema.');return}if(this.data.isEditMode&&this.data.group?.name.toLowerCase()!=="admin"&&n==="admin"){alert('O nome "Admin" \xE9 reservado para o grupo padr\xE3o do sistema.');return}if(this.data.existingGroups.some(s=>s.name.toLowerCase()===n&&s.id!==e.id)){alert("J\xE1 existe um grupo com este nome na empresa.");return}this.dialogRef.close(e)}}static{this.\u0275fac=function(n){return new(n||t)(u(O),u(L),u(R))}}static{this.\u0275cmp=b({type:t,selectors:[["app-group-dialog"]],standalone:!1,decls:20,vars:6,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Nome do grupo"],[4,"ngIf"],["matInput","","formControlName","description","placeholder","Descri\xE7\xE3o do grupo","rows","3"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(n,i){if(n&1&&(o(0,"h2",0),a(1),r(),o(2,"form",1),f("ngSubmit",function(){return i.onSubmit()}),o(3,"mat-dialog-content")(4,"mat-form-field",2)(5,"mat-label"),a(6,"Nome do Grupo"),r(),_(7,"input",3),c(8,at,2,0,"mat-error",4)(9,mt,2,0,"mat-error",4),r(),o(10,"mat-form-field",2)(11,"mat-label"),a(12,"Descri\xE7\xE3o"),r(),_(13,"textarea",5),c(14,st,2,0,"mat-error",4),r()(),o(15,"mat-dialog-actions",6)(16,"button",7),f("click",function(){return i.onCancel()}),a(17,"Cancelar"),r(),o(18,"button",8),a(19,"Salvar"),r()()()),n&2){let s,x,M;m(),h(i.dialogTitle),m(),d("formGroup",i.groupForm),m(6),d("ngIf",(s=i.groupForm.get("name"))==null?null:s.hasError("required")),m(),d("ngIf",(x=i.groupForm.get("name"))==null?null:x.hasError("maxlength")),m(5),d("ngIf",(M=i.groupForm.get("description"))==null?null:M.hasError("maxlength")),m(4),d("disabled",i.groupForm.invalid)}},dependencies:[S,N,T,G,k,P,U,D,F,A,$,w,B,V,j],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}mat-dialog-content[_ngcontent-%COMP%]{padding-top:10px;min-width:350px}"]})}}return t})(),it=(()=>{class t{constructor(e,n){this.dialogRef=e,this.data=n}onCancel(){this.dialogRef.close(!1)}onConfirm(){this.dialogRef.close(!0)}static{this.\u0275fac=function(n){return new(n||t)(u(L),u(R))}}static{this.\u0275cmp=b({type:t,selectors:[["app-confirm-dialog"]],standalone:!1,decls:11,vars:4,consts:[["mat-dialog-title",""],[4,"ngIf"],["class","warning-message",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click","disabled"],[1,"warning-message"],["color","warn"]],template:function(n,i){n&1&&(o(0,"h2",0),a(1,"Confirmar Exclus\xE3o"),r(),o(2,"mat-dialog-content"),c(3,lt,5,1,"p",1)(4,dt,2,1,"p",1)(5,ct,5,0,"div",2),r(),o(6,"mat-dialog-actions",3)(7,"button",4),f("click",function(){return i.onCancel()}),a(8,"Cancelar"),r(),o(9,"button",5),f("click",function(){return i.onConfirm()}),a(10,"Excluir"),r()()),n&2&&(m(3),d("ngIf",!i.data.message),m(),d("ngIf",i.data.message),m(),d("ngIf",i.data.isAdminGroup),m(4),d("disabled",i.data.isAdminGroup))},dependencies:[S,w,K,B,V,j],styles:[".warning-message[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:20px;padding:10px;background-color:#fff3e0;border-radius:4px}.warning-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px}"]})}}return t})(),Lt=(()=>{class t{constructor(e,n,i,s,x){this.companyManagementService=e,this.groupService=n,this.fb=i,this.snackBar=s,this.dialog=x,this.users=[],this.groups=[],this.isLoading=!0,this.activeTab=0}ngOnInit(){this.initForm(),this.loadCompanyData()}initForm(){this.companyForm=this.fb.group({id:[0],name:["",[g.required,g.maxLength(100)]],domain:["",g.maxLength(50)]})}loadCompanyData(){this.isLoading=!0,this.companyManagementService.getMyCompany().subscribe({next:e=>{this.company=e,this.companyForm.patchValue(e),this.loadCompanyUsers(),this.loadCompanyGroups()},error:e=>{console.error("Erro ao carregar dados da empresa",e),this.snackBar.open("Erro ao carregar dados da empresa. Por favor, tente novamente.","Fechar",{duration:5e3}),this.isLoading=!1}})}loadCompanyUsers(){this.companyManagementService.getCompanyUsers(this.company.id).subscribe({next:e=>{this.users=e,this.isLoading=!1},error:e=>{console.error("Erro ao carregar usu\xE1rios da empresa",e),this.snackBar.open("Erro ao carregar usu\xE1rios. Por favor, tente novamente.","Fechar",{duration:5e3}),this.isLoading=!1}})}loadCompanyGroups(){this.groupService.getByCompanyId(this.company.id).subscribe({next:e=>{this.groups=e},error:e=>{console.error("Erro ao carregar grupos da empresa",e),this.snackBar.open("Erro ao carregar grupos. Por favor, tente novamente.","Fechar",{duration:5e3})}})}saveCompany(){if(this.companyForm.invalid){this.snackBar.open("Por favor, preencha todos os campos obrigat\xF3rios.","Fechar",{duration:5e3});return}let e=this.companyForm.value;this.companyManagementService.update(e).subscribe({next:()=>{this.snackBar.open("Empresa atualizada com sucesso!","Fechar",{duration:3e3})},error:n=>{console.error("Erro ao atualizar empresa",n),this.snackBar.open("Erro ao atualizar empresa. Por favor, tente novamente.","Fechar",{duration:5e3})}})}openAddUserDialog(e){this.dialog.open(At,{width:"500px",data:{companyId:this.company.id,groupId:e.id,existingUsers:this.users,groupUsers:e.users||[]}}).afterClosed().subscribe(i=>{i&&this.addUserToGroup(i.userId,e.id)})}addUserToGroup(e,n){this.companyManagementService.addUserToGroup(e,n).subscribe({next:()=>{this.snackBar.open("Usu\xE1rio adicionado ao grupo com sucesso!","Fechar",{duration:3e3}),this.loadCompanyUsers(),this.loadCompanyGroups()},error:i=>{console.error("Erro ao adicionar usu\xE1rio ao grupo",i);let s=i.error?i.error:"Erro ao adicionar usu\xE1rio ao grupo. Por favor, tente novamente.";this.snackBar.open(s,"Fechar",{duration:5e3})}})}removeUserFromGroup(e,n){this.companyManagementService.removeUserFromGroup(e,n).subscribe({next:()=>{this.snackBar.open("Usu\xE1rio removido do grupo com sucesso!","Fechar",{duration:3e3}),this.loadCompanyUsers(),this.loadCompanyGroups()},error:i=>{console.error("Erro ao remover usu\xE1rio do grupo",i);let s=i.error?i.error:"Erro ao remover usu\xE1rio do grupo. Por favor, tente novamente.";this.snackBar.open(s,"Fechar",{duration:5e3})}})}getUserFullName(e){let n=this.users.find(i=>i.id===e);return n&&n.fullName?n.fullName:"Usu\xE1rio desconhecido"}changeTab(e){this.activeTab=e}openGroupDialog(e){if(e&&e.name.toLowerCase()==="Admin"){this.snackBar.open("N\xE3o \xE9 permitido editar o grupo Admin, pois ele \xE9 essencial para o funcionamento da aplica\xE7\xE3o.","Fechar",{duration:5e3});return}this.dialog.open($t,{width:"500px",data:{group:e,companyId:this.company.id,isEditMode:!!e,existingGroups:this.groups}}).afterClosed().subscribe(i=>{i&&(i.id===0?this.createGroup(i):this.updateGroup(i))})}createGroup(e){if(this.groups.find(i=>i.name.toLowerCase()===e.name.toLowerCase())){this.snackBar.open("J\xE1 existe um grupo com este nome na empresa.","Fechar",{duration:5e3});return}this.groupService.create(e).subscribe({next:i=>{this.snackBar.open("Grupo criado com sucesso!","Fechar",{duration:3e3}),this.loadCompanyGroups()},error:i=>{console.error("Erro ao criar grupo",i),i.error&&typeof i.error=="string"?this.snackBar.open(i.error,"Fechar",{duration:5e3}):this.snackBar.open("Erro ao criar grupo. Por favor, tente novamente.","Fechar",{duration:5e3})}})}updateGroup(e){if(e.name.toLowerCase()==="Admin"){this.snackBar.open("N\xE3o \xE9 permitido editar o grupo Admin.","Fechar",{duration:5e3});return}if(this.groups.find(i=>i.name.toLowerCase()===e.name.toLowerCase()&&i.id!==e.id)){this.snackBar.open("J\xE1 existe um grupo com este nome na empresa.","Fechar",{duration:5e3});return}this.groupService.update(e).subscribe({next:i=>{this.snackBar.open("Grupo atualizado com sucesso!","Fechar",{duration:3e3}),this.loadCompanyGroups()},error:i=>{console.error("Erro ao atualizar grupo",i),i.error&&typeof i.error=="string"?this.snackBar.open(i.error,"Fechar",{duration:5e3}):this.snackBar.open("Erro ao atualizar grupo. Por favor, tente novamente.","Fechar",{duration:5e3})}})}confirmDeleteGroup(e){if(e.name.toLowerCase()==="Admin"){this.snackBar.open("N\xE3o \xE9 permitido excluir o grupo Admin, pois ele \xE9 essencial para o funcionamento da aplica\xE7\xE3o.","Fechar",{duration:5e3});return}this.dialog.open(it,{width:"400px",data:{group:e,isAdminGroup:!1}}).afterClosed().subscribe(s=>{s&&this.deleteGroup(e.id)})}deleteGroup(e){this.groupService.deleteGroup(e).subscribe({next:()=>{this.snackBar.open("Grupo exclu\xEDdo com sucesso!","Fechar",{duration:3e3}),this.loadCompanyGroups()},error:n=>{console.error("Erro ao excluir grupo",n),this.snackBar.open("Erro ao excluir grupo. Por favor, tente novamente.","Fechar",{duration:5e3})}})}isAdminUserInAdminGroup(e,n){let i=this.groups.find(M=>M.id===n),s=this.users.find(M=>M.id===e),x=this.getCurrentUserId();return i?.name.toLowerCase()==="Admin"&&x===e}getCurrentUserId(){let e=localStorage.getItem("token");if(e)try{let n=e.split(".")[1];return JSON.parse(window.atob(n)).nameid||0}catch(n){return console.error("Erro ao decodificar token",n),0}return 0}confirmRemoveUserFromGroup(e,n){let i=n.name.toLowerCase()==="Admin",s=this.getCurrentUserId()===e.id;if(i&&s){this.snackBar.open("Voc\xEA n\xE3o pode remover a si mesmo do grupo Admin.","Fechar",{duration:5e3});return}this.dialog.open(it,{width:"400px",data:{group:n,isAdminGroup:!1,message:`Tem certeza que deseja remover ${e.fullName} do grupo ${n.name}?`}}).afterClosed().subscribe(M=>{M&&this.removeUserFromGroup(e.id,n.id)})}static{this.\u0275fac=function(n){return new(n||t)(u(we),u(Ie),u(O),u(ae),u(We))}}static{this.\u0275cmp=b({type:t,selectors:[["app-company-management"]],standalone:!1,decls:2,vars:2,consts:[["class","container",4,"ngIf"],["class","loading-container",4,"ngIf"],[1,"container"],[3,"selectedIndexChange","selectedIndex"],["label","Informa\xE7\xF5es da Empresa"],[1,"tab-content"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Nome da empresa"],[4,"ngIf"],["matInput","","formControlName","domain","placeholder","Dom\xEDnio (ex: empresa.com)"],[1,"action-row"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["label","Grupos"],[1,"action-bar"],["mat-raised-button","","color","primary",3,"click"],[1,"group-cards"],["class","group-card",4,"ngFor","ngForOf"],["label","Usu\xE1rios"],["mat-table","",1,"mat-elevation-z8","full-width",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","fullName"],["matColumnDef","email"],["matColumnDef","groups"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"group-card"],[1,"card-actions"],["mat-icon-button","","color","primary",3,"click","disabled","matTooltip"],["mat-icon-button","","color","warn",3,"click","disabled","matTooltip"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],[1,"user-list-item"],["mat-icon-button","","color","warn","matTooltip","Remover do grupo",3,"click","disabled","matTooltipDisabled","matTooltip"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"loading-container"],["diameter","50"]],template:function(n,i){n&1&&c(0,Nt,56,12,"div",0)(1,Pt,4,0,"div",1),n&2&&(d("ngIf",!i.isLoading),m(),d("ngIf",i.isLoading))},dependencies:[J,S,N,T,G,k,P,U,D,F,he,A,$,w,oe,de,ge,pe,fe,ue,ce,K,De,Ge,Ue,ke,Te,Oe,Ne,Pe,Ae,$e,ve,Me,Qe,Ve,Ye,Ze],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.tab-content[_ngcontent-%COMP%]{padding:20px 0}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.full-width[_ngcontent-%COMP%]{width:100%}.action-row[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:flex-end}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px}.action-bar[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;justify-content:flex-end}.group-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.group-card[_ngcontent-%COMP%]{height:100%}.group-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.group-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]{margin-left:auto;display:flex;align-items:center}.user-list-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}mat-tab-group[_ngcontent-%COMP%]{min-height:400px}table[_ngcontent-%COMP%]{width:100%}mat-card-header[_ngcontent-%COMP%]{margin-bottom:16px}"]})}}return t})(),Rt=(()=>{class t{constructor(e,n,i,s){this.fb=e,this.userService=n,this.router=i,this.authService=s,this.registerForm=this.fb.group({fullName:this.fb.control("",[g.required,g.minLength(3),g.maxLength(15)]),passwordHash:this.fb.control("",[g.required,g.minLength(8),g.maxLength(30)]),email:this.fb.control("",[g.required,g.maxLength(30)])})}onSubmit(){if(this.registerForm.invalid){this.registerForm.markAllAsTouched();return}this.userService.register(this.registerForm.value,!0).subscribe(e=>{this.authService.authenticate(e.token),this.router.navigate(["/Dashboard"])})}getUsernameError(){let e=this.registerForm.get("fullName");return e?.hasError("required")?"Nome de usu\xE1rio \xE9 obrigat\xF3rio":e?.hasError("minlength")?"M\xEDnimo 3 caracteres":e?.hasError("maxlength")?"M\xE1ximo de 15 caracteres":null}getPasswordError(){let e=this.registerForm.get("passwordHash");return e?.hasError("required")?"Senha \xE9 obrigat\xF3ria":e?.hasError("minlength")?"M\xEDnimo 8 caracteres":e?.hasError("maxlength")?"M\xE1ximo de 30 caracteres":null}onGoogleLogin(){this.authService.getFirebaseToken().then(e=>{e&&this.userService.loginGoogle(e).subscribe(n=>{this.authService.authenticate(n.token),this.router.navigate(["/"])})})}static{this.\u0275fac=function(n){return new(n||t)(u(O),u(Fe),u(ie),u(Se))}}static{this.\u0275cmp=b({type:t,selectors:[["app-company-register"]],standalone:!1,decls:29,vars:3,consts:[[1,"register"],[1,"register-container"],[1,"register-left"],[1,"register-header"],[1,"fs-2","fw-medium"],[1,"fs-6",2,"color","rgb(140, 140, 140)"],[1,"register-form",3,"ngSubmit","formGroup"],["type","text","matInput","","formControlName","fullName"],[4,"ngIf"],["type","email","matInput","","formControlName","email"],["type","password","matInput","","formControlName","passwordHash","placeholder","Ex. pat@example.com"],["type","submit","mat-stroked-button","",2,"background-color","var(--primary-color)","color","white"],[1,"register-image"],["src","assets/images/studying.jpg","alt","Register Image"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),a(5,"Cadastrar Empresa"),r(),o(6,"h3",5),a(7,"Preencha suas informa\xE7\xF5es para criar uma conta"),r()(),o(8,"form",6),f("ngSubmit",function(){return i.onSubmit()}),o(9,"mat-form-field")(10,"mat-label"),a(11,"Nome de usu\xE1rio"),r(),_(12,"input",7),c(13,Ut,2,1,"mat-error",8),r(),o(14,"mat-form-field")(15,"mat-label"),a(16,"Email"),r(),_(17,"input",9),r(),o(18,"mat-form-field")(19,"mat-label"),a(20,"Senha"),r(),_(21,"input",10),c(22,Ot,2,1,"mat-error",8),r(),o(23,"mat-checkbox"),a(24,"Li e concordo com os termos e condi\xE7\xF5es"),r(),o(25,"button",11),a(26,"Criar conta"),r()()(),o(27,"div",12),_(28,"img",13),r()()()),n&2&&(m(8),d("formGroup",i.registerForm),m(5),d("ngIf",i.getUsernameError()),m(9),d("ngIf",i.getPasswordError()))},dependencies:[S,N,T,G,k,P,U,D,F,A,$,w,ye],styles:['@charset "UTF-8";.register[_ngcontent-%COMP%]{background-color:var(--background-color);display:flex;justify-content:center;align-items:center;width:100%;min-height:100vh;padding:1rem;box-sizing:border-box}.register-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80%;max-width:1000px;min-height:70vh;background-color:#fff;box-shadow:0 2px 10px #0000001a;border-radius:8px;overflow:hidden}.register-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:55%;padding:2rem}.register-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.register-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;width:100%;max-width:320px}.register-image[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center;background-color:var(--primary-color)}.register-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}@media (max-width: 992px){.register-container[_ngcontent-%COMP%]{width:90%}.register-left[_ngcontent-%COMP%]{width:60%;padding:1.5rem}.register-form[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 768px){.register-container[_ngcontent-%COMP%]{flex-direction:column;width:95%;min-height:auto}.register-left[_ngcontent-%COMP%]{width:100%;padding:2rem 1.5rem;border-radius:0}.register-image[_ngcontent-%COMP%]{width:100%;height:200px;border-top:1px solid #eee;border-radius:0}.register-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:0}}@media (max-width: 480px){.register-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.4rem}.register-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.9rem}.register-form[_ngcontent-%COMP%]{gap:12px}button[mat-stroked-button][_ngcontent-%COMP%]{font-size:.9rem}}']})}}return t})(),Bt=[{path:"management",component:Lt},{path:"register",component:Rt}],Ii=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=Q({imports:[ee,se,le,te,ne.forChild(Bt),xe,Ce,re,_e,me,Le,He,qe,Je,je,be,Ke,Xe,ze,et,Ee]})}}return t})();export{Ii as CompanyModule};
